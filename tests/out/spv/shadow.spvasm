; SPIR-V
; Version: 1.2
; Generator: rspirv
; Bound: 270
OpCapability Shader
OpExtension "SPV_KHR_storage_buffer_storage_class"
%1 = OpExtInstImport "GLSL.std.450"
OpMemoryModel Logical GLSL450
OpEntryPoint Vertex %89 "vs_main" %79 %82 %84 %86 %88
OpEntryPoint Fragment %147 "fs_main" %138 %141 %144 %146
OpEntryPoint Fragment %215 "fs_main_without_storage" %208 %210 %212 %214
OpExecutionMode %147 OriginUpperLeft
OpExecutionMode %215 OriginUpperLeft
OpMemberName %8 0 "view_proj"
OpMemberName %8 1 "num_lights"
OpName %8 "Globals"
OpMemberName %9 0 "world"
OpMemberName %9 1 "color"
OpName %9 "Entity"
OpMemberName %11 0 "proj_position"
OpMemberName %11 1 "world_normal"
OpMemberName %11 2 "world_position"
OpName %11 "VertexOutput"
OpMemberName %15 0 "proj"
OpMemberName %15 1 "pos"
OpMemberName %15 2 "color"
OpName %15 "Light"
OpName %28 "c_ambient"
OpName %18 "c_max_lights"
OpName %29 "u_globals"
OpName %32 "u_entity"
OpName %35 "s_lights"
OpName %38 "u_lights"
OpName %41 "t_shadow"
OpName %43 "sampler_shadow"
OpName %46 "light_id"
OpName %47 "homogeneous_coords"
OpName %48 "fetch_shadow"
OpName %79 "position"
OpName %82 "normal"
OpName %84 "proj_position"
OpName %86 "world_normal"
OpName %88 "world_position"
OpName %89 "vs_main"
OpName %96 "out"
OpName %138 "proj_position"
OpName %141 "world_normal"
OpName %144 "world_position"
OpName %147 "fs_main"
OpName %154 "color"
OpName %155 "i"
OpName %208 "proj_position"
OpName %210 "world_normal"
OpName %212 "world_position"
OpName %215 "fs_main_without_storage"
OpName %222 "color"
OpName %223 "i"
OpMemberDecorate %8 0 Offset 0
OpMemberDecorate %8 0 ColMajor
OpMemberDecorate %8 0 MatrixStride 16
OpMemberDecorate %8 1 Offset 64
OpMemberDecorate %9 0 Offset 0
OpMemberDecorate %9 0 ColMajor
OpMemberDecorate %9 0 MatrixStride 16
OpMemberDecorate %9 1 Offset 64
OpMemberDecorate %11 0 Offset 0
OpMemberDecorate %11 1 Offset 16
OpMemberDecorate %11 2 Offset 32
OpMemberDecorate %15 0 Offset 0
OpMemberDecorate %15 0 ColMajor
OpMemberDecorate %15 0 MatrixStride 16
OpMemberDecorate %15 1 Offset 64
OpMemberDecorate %15 2 Offset 80
OpDecorate %16 ArrayStride 96
OpDecorate %17 ArrayStride 96
OpDecorate %29 DescriptorSet 0
OpDecorate %29 Binding 0
OpDecorate %30 Block
OpMemberDecorate %30 0 Offset 0
OpDecorate %32 DescriptorSet 1
OpDecorate %32 Binding 0
OpDecorate %33 Block
OpMemberDecorate %33 0 Offset 0
OpDecorate %35 NonWritable
OpDecorate %35 DescriptorSet 0
OpDecorate %35 Binding 1
OpDecorate %36 Block
OpMemberDecorate %36 0 Offset 0
OpDecorate %38 DescriptorSet 0
OpDecorate %38 Binding 1
OpDecorate %39 Block
OpMemberDecorate %39 0 Offset 0
OpDecorate %41 DescriptorSet 0
OpDecorate %41 Binding 2
OpDecorate %43 DescriptorSet 0
OpDecorate %43 Binding 3
OpDecorate %79 Location 0
OpDecorate %82 Location 1
OpDecorate %84 BuiltIn Position
OpDecorate %86 Location 0
OpDecorate %88 Location 1
OpDecorate %138 BuiltIn FragCoord
OpDecorate %141 Location 0
OpDecorate %144 Location 1
OpDecorate %146 Location 0
OpDecorate %208 BuiltIn FragCoord
OpDecorate %210 Location 0
OpDecorate %212 Location 1
OpDecorate %214 Location 0
%2 = OpTypeVoid
%5 = OpTypeFloat 32
%4 = OpTypeVector %5 4
%3 = OpTypeMatrix %4 4
%7 = OpTypeInt 32 0
%6 = OpTypeVector %7 4
%8 = OpTypeStruct %3 %6
%9 = OpTypeStruct %3 %4
%10 = OpTypeVector %5 3
%11 = OpTypeStruct %4 %10 %4
%13 = OpTypeInt 32 1
%12 = OpTypeVector %13 4
%14 = OpTypeMatrix %10 3
%15 = OpTypeStruct %3 %4 %4
%16 = OpTypeRuntimeArray %15
%18 = OpConstant  %7  10
%17 = OpTypeArray %15 %18
%19 = OpTypeImage %5 2D 1 1 0 1 Unknown
%20 = OpTypeSampler
%21 = OpTypeVector %5 2
%22 = OpConstant  %13  0
%23 = OpConstant  %13  1
%24 = OpConstant  %13  10
%25 = OpConstant  %13  2
%26 = OpConstant  %13  3
%27 = OpConstant  %5  0.05
%28 = OpConstantComposite  %10  %27 %27 %27
%30 = OpTypeStruct %8
%31 = OpTypePointer Uniform %30
%29 = OpVariable  %31  Uniform
%33 = OpTypeStruct %9
%34 = OpTypePointer Uniform %33
%32 = OpVariable  %34  Uniform
%36 = OpTypeStruct %16
%37 = OpTypePointer StorageBuffer %36
%35 = OpVariable  %37  StorageBuffer
%39 = OpTypeStruct %17
%40 = OpTypePointer Uniform %39
%38 = OpVariable  %40  Uniform
%42 = OpTypePointer UniformConstant %19
%41 = OpVariable  %42  UniformConstant
%44 = OpTypePointer UniformConstant %20
%43 = OpVariable  %44  UniformConstant
%49 = OpTypeFunction %5 %7 %4
%52 = OpConstant  %5  0.0
%53 = OpConstant  %5  1.0
%54 = OpConstant  %5  0.5
%55 = OpConstant  %5  -0.5
%56 = OpConstantComposite  %21  %54 %55
%57 = OpConstantComposite  %21  %54 %54
%60 = OpTypeBool
%73 = OpTypeSampledImage %19
%80 = OpTypePointer Input %12
%79 = OpVariable  %80  Input
%82 = OpVariable  %80  Input
%85 = OpTypePointer Output %4
%84 = OpVariable  %85  Output
%87 = OpTypePointer Output %10
%86 = OpVariable  %87  Output
%88 = OpVariable  %85  Output
%90 = OpTypeFunction %2
%91 = OpTypePointer Uniform %8
%92 = OpConstant  %7  0
%94 = OpTypePointer Uniform %9
%97 = OpTypePointer Function %11
%98 = OpConstantNull  %11
%100 = OpTypePointer Uniform %3
%107 = OpTypePointer Function %10
%115 = OpTypeVector %13 3
%119 = OpConstant  %7  1
%121 = OpTypePointer Function %4
%122 = OpConstant  %7  2
%130 = OpTypePointer Output %5
%139 = OpTypePointer Input %4
%138 = OpVariable  %139  Input
%142 = OpTypePointer Input %10
%141 = OpVariable  %142  Input
%144 = OpVariable  %139  Input
%146 = OpVariable  %85  Output
%150 = OpTypePointer StorageBuffer %16
%156 = OpTypePointer Function %7
%165 = OpTypePointer Uniform %6
%166 = OpTypePointer Uniform %7
%176 = OpTypePointer StorageBuffer %15
%202 = OpTypePointer Uniform %4
%208 = OpVariable  %139  Input
%210 = OpVariable  %142  Input
%212 = OpVariable  %139  Input
%214 = OpVariable  %85  Output
%218 = OpTypePointer Uniform %17
%241 = OpTypePointer Uniform %15
%48 = OpFunction  %5  None %49
%46 = OpFunctionParameter  %7
%47 = OpFunctionParameter  %4
%45 = OpLabel
%50 = OpLoad  %19  %41
%51 = OpLoad  %20  %43
OpBranch %58
%58 = OpLabel
%59 = OpCompositeExtract  %5  %47 3
%61 = OpFOrdLessThanEqual  %60  %59 %52
OpSelectionMerge %62 None
OpBranchConditional %61 %63 %62
%63 = OpLabel
OpReturnValue %53
%62 = OpLabel
%64 = OpCompositeExtract  %5  %47 3
%65 = OpFDiv  %5  %53 %64
%66 = OpVectorShuffle  %21  %47 %47 0 1
%67 = OpFMul  %21  %66 %56
%68 = OpVectorTimesScalar  %21  %67 %65
%69 = OpFAdd  %21  %68 %57
%70 = OpBitcast  %13  %46
%71 = OpCompositeExtract  %5  %47 2
%72 = OpFMul  %5  %71 %65
%74 = OpConvertSToF  %5  %70
%75 = OpCompositeConstruct  %10  %69 %74
%76 = OpSampledImage  %73  %50 %51
%77 = OpImageSampleDrefExplicitLod  %5  %76 %75 %72 Lod %52
OpReturnValue %77
OpFunctionEnd
%89 = OpFunction  %2  None %90
%78 = OpLabel
%96 = OpVariable  %97  Function %98
%81 = OpLoad  %12  %79
%83 = OpLoad  %12  %82
%93 = OpAccessChain  %91  %29 %92
%95 = OpAccessChain  %94  %32 %92
OpBranch %99
%99 = OpLabel
%101 = OpAccessChain  %100  %95 %92
%102 = OpLoad  %3  %101
%103 = OpAccessChain  %100  %95 %92
%104 = OpLoad  %3  %103
%105 = OpConvertSToF  %4  %81
%106 = OpMatrixTimesVector  %4  %104 %105
%108 = OpCompositeExtract  %4  %102 0
%109 = OpVectorShuffle  %10  %108 %108 0 1 2
%110 = OpCompositeExtract  %4  %102 1
%111 = OpVectorShuffle  %10  %110 %110 0 1 2
%112 = OpCompositeExtract  %4  %102 2
%113 = OpVectorShuffle  %10  %112 %112 0 1 2
%114 = OpCompositeConstruct  %14  %109 %111 %113
%116 = OpVectorShuffle  %115  %83 %83 0 1 2
%117 = OpConvertSToF  %10  %116
%118 = OpMatrixTimesVector  %10  %114 %117
%120 = OpAccessChain  %107  %96 %119
OpStore %120 %118
%123 = OpAccessChain  %121  %96 %122
OpStore %123 %106
%124 = OpAccessChain  %100  %93 %92
%125 = OpLoad  %3  %124
%126 = OpMatrixTimesVector  %4  %125 %106
%127 = OpAccessChain  %121  %96 %92
OpStore %127 %126
%128 = OpLoad  %11  %96
%129 = OpCompositeExtract  %4  %128 0
OpStore %84 %129
%131 = OpAccessChain  %130  %84 %119
%132 = OpLoad  %5  %131
%133 = OpFNegate  %5  %132
OpStore %131 %133
%134 = OpCompositeExtract  %10  %128 1
OpStore %86 %134
%135 = OpCompositeExtract  %4  %128 2
OpStore %88 %135
OpReturn
OpFunctionEnd
%147 = OpFunction  %2  None %90
%136 = OpLabel
%154 = OpVariable  %107  Function %28
%155 = OpVariable  %156  Function %92
%140 = OpLoad  %4  %138
%143 = OpLoad  %10  %141
%145 = OpLoad  %4  %144
%137 = OpCompositeConstruct  %11  %140 %143 %145
%148 = OpAccessChain  %91  %29 %92
%149 = OpAccessChain  %94  %32 %92
%151 = OpAccessChain  %150  %35 %92
%152 = OpLoad  %19  %41
%153 = OpLoad  %20  %43
OpBranch %157
%157 = OpLabel
%158 = OpCompositeExtract  %10  %137 1
%159 = OpExtInst  %10  %1 Normalize %158
OpBranch %160
%160 = OpLabel
OpLoopMerge %161 %163 None
OpBranch %162
%162 = OpLabel
%164 = OpLoad  %7  %155
%167 = OpAccessChain  %166  %148 %119 %92
%168 = OpLoad  %7  %167
%169 = OpExtInst  %7  %1 UMin %168 %18
%170 = OpULessThan  %60  %164 %169
OpSelectionMerge %171 None
OpBranchConditional %170 %171 %172
%172 = OpLabel
OpBranch %161
%171 = OpLabel
OpBranch %173
%173 = OpLabel
%175 = OpLoad  %7  %155
%177 = OpAccessChain  %176  %151 %175
%178 = OpLoad  %15  %177
%179 = OpLoad  %7  %155
%180 = OpCompositeExtract  %3  %178 0
%181 = OpCompositeExtract  %4  %137 2
%182 = OpMatrixTimesVector  %4  %180 %181
%183 = OpFunctionCall  %5  %48 %179 %182
%184 = OpCompositeExtract  %4  %178 1
%185 = OpVectorShuffle  %10  %184 %184 0 1 2
%186 = OpCompositeExtract  %4  %137 2
%187 = OpVectorShuffle  %10  %186 %186 0 1 2
%188 = OpFSub  %10  %185 %187
%189 = OpExtInst  %10  %1 Normalize %188
%190 = OpDot  %5  %159 %189
%191 = OpExtInst  %5  %1 FMax %52 %190
%192 = OpFMul  %5  %183 %191
%193 = OpCompositeExtract  %4  %178 2
%194 = OpVectorShuffle  %10  %193 %193 0 1 2
%195 = OpVectorTimesScalar  %10  %194 %192
%196 = OpLoad  %10  %154
%197 = OpFAdd  %10  %196 %195
OpStore %154 %197
OpBranch %174
%174 = OpLabel
OpBranch %163
%163 = OpLabel
%198 = OpLoad  %7  %155
%199 = OpIAdd  %7  %198 %119
OpStore %155 %199
OpBranch %160
%161 = OpLabel
%200 = OpLoad  %10  %154
%201 = OpCompositeConstruct  %4  %200 %53
%203 = OpAccessChain  %202  %149 %119
%204 = OpLoad  %4  %203
%205 = OpFMul  %4  %201 %204
OpStore %146 %205
OpReturn
OpFunctionEnd
%215 = OpFunction  %2  None %90
%206 = OpLabel
%222 = OpVariable  %107  Function %28
%223 = OpVariable  %156  Function %92
%209 = OpLoad  %4  %208
%211 = OpLoad  %10  %210
%213 = OpLoad  %4  %212
%207 = OpCompositeConstruct  %11  %209 %211 %213
%216 = OpAccessChain  %91  %29 %92
%217 = OpAccessChain  %94  %32 %92
%219 = OpAccessChain  %218  %38 %92
%220 = OpLoad  %19  %41
%221 = OpLoad  %20  %43
OpBranch %224
%224 = OpLabel
%225 = OpCompositeExtract  %10  %207 1
%226 = OpExtInst  %10  %1 Normalize %225
OpBranch %227
%227 = OpLabel
OpLoopMerge %228 %230 None
OpBranch %229
%229 = OpLabel
%231 = OpLoad  %7  %223
%232 = OpAccessChain  %166  %216 %119 %92
%233 = OpLoad  %7  %232
%234 = OpExtInst  %7  %1 UMin %233 %18
%235 = OpULessThan  %60  %231 %234
OpSelectionMerge %236 None
OpBranchConditional %235 %236 %237
%237 = OpLabel
OpBranch %228
%236 = OpLabel
OpBranch %238
%238 = OpLabel
%240 = OpLoad  %7  %223
%242 = OpAccessChain  %241  %219 %240
%243 = OpLoad  %15  %242
%244 = OpLoad  %7  %223
%245 = OpCompositeExtract  %3  %243 0
%246 = OpCompositeExtract  %4  %207 2
%247 = OpMatrixTimesVector  %4  %245 %246
%248 = OpFunctionCall  %5  %48 %244 %247
%249 = OpCompositeExtract  %4  %243 1
%250 = OpVectorShuffle  %10  %249 %249 0 1 2
%251 = OpCompositeExtract  %4  %207 2
%252 = OpVectorShuffle  %10  %251 %251 0 1 2
%253 = OpFSub  %10  %250 %252
%254 = OpExtInst  %10  %1 Normalize %253
%255 = OpDot  %5  %226 %254
%256 = OpExtInst  %5  %1 FMax %52 %255
%257 = OpFMul  %5  %248 %256
%258 = OpCompositeExtract  %4  %243 2
%259 = OpVectorShuffle  %10  %258 %258 0 1 2
%260 = OpVectorTimesScalar  %10  %259 %257
%261 = OpLoad  %10  %222
%262 = OpFAdd  %10  %261 %260
OpStore %222 %262
OpBranch %239
%239 = OpLabel
OpBranch %230
%230 = OpLabel
%263 = OpLoad  %7  %223
%264 = OpIAdd  %7  %263 %119
OpStore %223 %264
OpBranch %227
%228 = OpLabel
%265 = OpLoad  %10  %222
%266 = OpCompositeConstruct  %4  %265 %53
%267 = OpAccessChain  %202  %217 %119
%268 = OpLoad  %4  %267
%269 = OpFMul  %4  %266 %268
OpStore %214 %269
OpReturn
OpFunctionEnd