; SPIR-V
; Version: 1.2
; Generator: rspirv
; Bound: 274
OpCapability Shader
OpExtension "SPV_KHR_storage_buffer_storage_class"
%1 = OpExtInstImport "GLSL.std.450"
OpMemoryModel Logical GLSL450
OpEntryPoint Vertex %96 "vs_main" %86 %89 %91 %93 %95
OpEntryPoint Fragment %151 "fs_main" %142 %145 %148 %150
OpEntryPoint Fragment %220 "fs_main_without_storage" %213 %215 %217 %219
OpExecutionMode %151 OriginUpperLeft
OpExecutionMode %220 OriginUpperLeft
OpSource GLSL 450
OpName %10 "c_max_lights"
OpName %13 "mat4x4<f32>"
OpName %15 "vec4<u32>"
OpMemberName %16 0 "view_proj"
OpMemberName %16 1 "num_lights"
OpName %16 "Globals"
OpName %14 "vec4<f32>"
OpMemberName %17 0 "world"
OpMemberName %17 1 "color"
OpName %17 "Entity"
OpName %18 "vec3<f32>"
OpMemberName %19 0 "proj_position"
OpMemberName %19 1 "world_normal"
OpMemberName %19 2 "world_position"
OpName %19 "VertexOutput"
OpName %20 "vec4<i32>"
OpName %22 "ptr<uniform, Entity>"
OpName %23 "mat3x3<f32>"
OpName %24 "vec3<i32>"
OpName %25 "ptr<function, VertexOutput>"
OpName %26 "ptr<uniform, Globals>"
OpMemberName %27 0 "proj"
OpMemberName %27 1 "pos"
OpMemberName %27 2 "color"
OpName %27 "Light"
OpName %28 "array<Light>"
OpName %29 "array<Light, 10>"
OpName %30 "texture_depth_2d_array"
OpName %31 "sampler_comparison"
OpName %4 "u32"
OpName %6 "f32"
OpName %32 "vec2<f32>"
OpName %21 "i32"
OpName %33 "ptr<uniform, vec4<u32>>"
OpName %34 "ptr<storage, array<Light>>"
OpName %35 "ptr<uniform, array<Light, 10>>"
OpName %36 "c_ambient"
OpName %37 "u_globals"
OpName %40 "u_entity"
OpName %43 "s_lights"
OpName %46 "u_lights"
OpName %49 "t_shadow"
OpName %51 "sampler_shadow"
OpName %54 "light_id"
OpName %55 "homogeneous_coords"
OpName %56 "fetch_shadow"
OpName %83 "out"
OpName %86 "position"
OpName %89 "normal"
OpName %91 "proj_position"
OpName %93 "world_normal"
OpName %95 "world_position"
OpName %96 "vs_main"
OpName %135 "color"
OpName %137 "i"
OpName %142 "proj_position"
OpName %145 "world_normal"
OpName %148 "world_position"
OpName %151 "fs_main"
OpName %207 "color"
OpName %209 "i"
OpName %213 "proj_position"
OpName %215 "world_normal"
OpName %217 "world_position"
OpName %220 "fs_main_without_storage"
OpMemberDecorate %16 0 Offset 0
OpMemberDecorate %16 0 ColMajor
OpMemberDecorate %16 0 MatrixStride 16
OpMemberDecorate %16 1 Offset 64
OpMemberDecorate %17 0 Offset 0
OpMemberDecorate %17 0 ColMajor
OpMemberDecorate %17 0 MatrixStride 16
OpMemberDecorate %17 1 Offset 64
OpMemberDecorate %19 0 Offset 0
OpMemberDecorate %19 1 Offset 16
OpMemberDecorate %19 2 Offset 32
OpMemberDecorate %27 0 Offset 0
OpMemberDecorate %27 0 ColMajor
OpMemberDecorate %27 0 MatrixStride 16
OpMemberDecorate %27 1 Offset 64
OpMemberDecorate %27 2 Offset 80
OpDecorate %28 ArrayStride 96
OpDecorate %29 ArrayStride 96
OpDecorate %37 DescriptorSet 0
OpDecorate %37 Binding 0
OpDecorate %38 Block
OpMemberDecorate %38 0 Offset 0
OpDecorate %40 DescriptorSet 1
OpDecorate %40 Binding 0
OpDecorate %41 Block
OpMemberDecorate %41 0 Offset 0
OpDecorate %43 NonWritable
OpDecorate %43 DescriptorSet 0
OpDecorate %43 Binding 1
OpDecorate %44 Block
OpMemberDecorate %44 0 Offset 0
OpDecorate %46 DescriptorSet 0
OpDecorate %46 Binding 1
OpDecorate %47 Block
OpMemberDecorate %47 0 Offset 0
OpDecorate %49 DescriptorSet 0
OpDecorate %49 Binding 2
OpDecorate %51 DescriptorSet 0
OpDecorate %51 Binding 3
OpDecorate %86 Location 0
OpDecorate %89 Location 1
OpDecorate %91 BuiltIn Position
OpDecorate %93 Location 0
OpDecorate %95 Location 1
OpDecorate %142 BuiltIn FragCoord
OpDecorate %145 Location 0
OpDecorate %148 Location 1
OpDecorate %150 Location 0
OpDecorate %213 BuiltIn FragCoord
OpDecorate %215 Location 0
OpDecorate %217 Location 1
OpDecorate %219 Location 0
%2 = OpTypeVoid
%4 = OpTypeInt 32 0
%3 = OpConstant  %4  10
%6 = OpTypeFloat 32
%5 = OpConstant  %6  0.0
%7 = OpConstant  %6  1.0
%8 = OpConstant  %6  0.5
%9 = OpConstant  %6  0.05
%10 = OpConstant  %4  10
%11 = OpConstant  %4  0
%12 = OpConstant  %4  1
%14 = OpTypeVector %6 4
%13 = OpTypeMatrix %14 4
%15 = OpTypeVector %4 4
%16 = OpTypeStruct %13 %15
%17 = OpTypeStruct %13 %14
%18 = OpTypeVector %6 3
%19 = OpTypeStruct %14 %18 %14
%21 = OpTypeInt 32 1
%20 = OpTypeVector %21 4
%22 = OpTypePointer Uniform %17
%23 = OpTypeMatrix %18 3
%24 = OpTypeVector %21 3
%25 = OpTypePointer Function %19
%26 = OpTypePointer Uniform %16
%27 = OpTypeStruct %13 %14 %14
%28 = OpTypeRuntimeArray %27
%29 = OpTypeArray %27 %3
%30 = OpTypeImage %6 2D 1 1 0 1 Unknown
%31 = OpTypeSampler
%32 = OpTypeVector %6 2
%33 = OpTypePointer Uniform %15
%34 = OpTypePointer StorageBuffer %28
%35 = OpTypePointer Uniform %29
%36 = OpConstantComposite  %18  %9 %9 %9
%38 = OpTypeStruct %16
%39 = OpTypePointer Uniform %38
%37 = OpVariable  %39  Uniform
%41 = OpTypeStruct %17
%42 = OpTypePointer Uniform %41
%40 = OpVariable  %42  Uniform
%44 = OpTypeStruct %28
%45 = OpTypePointer StorageBuffer %44
%43 = OpVariable  %45  StorageBuffer
%47 = OpTypeStruct %29
%48 = OpTypePointer Uniform %47
%46 = OpVariable  %48  Uniform
%50 = OpTypePointer UniformConstant %30
%49 = OpVariable  %50  UniformConstant
%52 = OpTypePointer UniformConstant %31
%51 = OpVariable  %52  UniformConstant
%57 = OpTypeFunction %6 %4 %14
%62 = OpTypeBool
%78 = OpTypeSampledImage %30
%84 = OpConstantNull  %19
%87 = OpTypePointer Input %20
%86 = OpVariable  %87  Input
%89 = OpVariable  %87  Input
%92 = OpTypePointer Output %14
%91 = OpVariable  %92  Output
%94 = OpTypePointer Output %18
%93 = OpVariable  %94  Output
%95 = OpVariable  %92  Output
%97 = OpTypeFunction %2
%101 = OpTypePointer Uniform %13
%118 = OpTypePointer Function %18
%120 = OpTypePointer Function %14
%121 = OpConstant  %4  2
%129 = OpTypePointer Output %6
%136 = OpConstantNull  %18
%138 = OpTypePointer Function %4
%139 = OpConstantNull  %4
%143 = OpTypePointer Input %14
%142 = OpVariable  %143  Input
%146 = OpTypePointer Input %18
%145 = OpVariable  %146  Input
%148 = OpVariable  %143  Input
%150 = OpVariable  %92  Output
%167 = OpTypePointer Uniform %4
%177 = OpTypePointer StorageBuffer %27
%203 = OpTypePointer Uniform %14
%208 = OpConstantNull  %18
%210 = OpConstantNull  %4
%213 = OpVariable  %143  Input
%215 = OpVariable  %146  Input
%217 = OpVariable  %143  Input
%219 = OpVariable  %92  Output
%245 = OpTypePointer Uniform %27
%56 = OpFunction  %6  None %57
%54 = OpFunctionParameter  %4
%55 = OpFunctionParameter  %14
%53 = OpLabel
%58 = OpLoad  %30  %49
%59 = OpLoad  %31  %51
OpBranch %60
%60 = OpLabel
%61 = OpCompositeExtract  %6  %55 3
%63 = OpFOrdLessThanEqual  %62  %61 %5
OpSelectionMerge %64 None
OpBranchConditional %63 %65 %64
%65 = OpLabel
OpReturnValue %7
%64 = OpLabel
%66 = OpFNegate  %6  %8
%67 = OpCompositeConstruct  %32  %8 %66
%68 = OpCompositeExtract  %6  %55 3
%69 = OpFDiv  %6  %7 %68
%70 = OpVectorShuffle  %32  %55 %55 0 1
%71 = OpFMul  %32  %70 %67
%72 = OpVectorTimesScalar  %32  %71 %69
%73 = OpCompositeConstruct  %32  %8 %8
%74 = OpFAdd  %32  %72 %73
%75 = OpBitcast  %21  %54
%76 = OpCompositeExtract  %6  %55 2
%77 = OpFMul  %6  %76 %69
%79 = OpConvertUToF  %6  %75
%80 = OpCompositeConstruct  %18  %74 %79
%81 = OpSampledImage  %78  %58 %59
%82 = OpImageSampleDrefExplicitLod  %6  %81 %80 %77 Lod %5
OpReturnValue %82
OpFunctionEnd
%96 = OpFunction  %2  None %97
%85 = OpLabel
%83 = OpVariable  %25  Function %84
%88 = OpLoad  %20  %86
%90 = OpLoad  %20  %89
%98 = OpAccessChain  %26  %37 %11
%99 = OpAccessChain  %22  %40 %11
OpBranch %100
%100 = OpLabel
%102 = OpAccessChain  %101  %99 %11
%103 = OpLoad  %13  %102
%104 = OpAccessChain  %101  %99 %11
%105 = OpLoad  %13  %104
%106 = OpConvertSToF  %14  %88
%107 = OpMatrixTimesVector  %14  %105 %106
%108 = OpCompositeExtract  %14  %103 0
%109 = OpVectorShuffle  %18  %108 %108 0 1 2
%110 = OpCompositeExtract  %14  %103 1
%111 = OpVectorShuffle  %18  %110 %110 0 1 2
%112 = OpCompositeExtract  %14  %103 2
%113 = OpVectorShuffle  %18  %112 %112 0 1 2
%114 = OpCompositeConstruct  %23  %109 %111 %113
%115 = OpVectorShuffle  %24  %90 %90 0 1 2
%116 = OpConvertSToF  %18  %115
%117 = OpMatrixTimesVector  %18  %114 %116
%119 = OpAccessChain  %118  %83 %12
OpStore %119 %117
%122 = OpAccessChain  %120  %83 %121
OpStore %122 %107
%123 = OpAccessChain  %101  %98 %11
%124 = OpLoad  %13  %123
%125 = OpMatrixTimesVector  %14  %124 %107
%126 = OpAccessChain  %120  %83 %11
OpStore %126 %125
%127 = OpLoad  %19  %83
%128 = OpCompositeExtract  %14  %127 0
OpStore %91 %128
%130 = OpAccessChain  %129  %91 %12
%131 = OpLoad  %6  %130
%132 = OpFNegate  %6  %131
OpStore %130 %132
%133 = OpCompositeExtract  %18  %127 1
OpStore %93 %133
%134 = OpCompositeExtract  %14  %127 2
OpStore %95 %134
OpReturn
OpFunctionEnd
%151 = OpFunction  %2  None %97
%140 = OpLabel
%135 = OpVariable  %118  Function %136
%137 = OpVariable  %138  Function %139
%144 = OpLoad  %14  %142
%147 = OpLoad  %18  %145
%149 = OpLoad  %14  %148
%141 = OpCompositeConstruct  %19  %144 %147 %149
%152 = OpAccessChain  %26  %37 %11
%153 = OpAccessChain  %22  %40 %11
%154 = OpAccessChain  %34  %43 %11
%155 = OpLoad  %30  %49
%156 = OpLoad  %31  %51
OpBranch %157
%157 = OpLabel
%158 = OpCompositeExtract  %18  %141 1
%159 = OpExtInst  %18  %1 Normalize %158
OpStore %135 %36
OpBranch %160
%160 = OpLabel
OpStore %137 %11
OpBranch %162
%162 = OpLabel
OpLoopMerge %163 %165 None
OpBranch %164
%164 = OpLabel
%166 = OpLoad  %4  %137
%168 = OpAccessChain  %167  %152 %12 %11
%169 = OpLoad  %4  %168
%170 = OpExtInst  %4  %1 UMin %169 %10
%171 = OpULessThan  %62  %166 %170
OpSelectionMerge %172 None
OpBranchConditional %171 %172 %173
%173 = OpLabel
OpBranch %163
%172 = OpLabel
OpBranch %174
%174 = OpLabel
%176 = OpLoad  %4  %137
%178 = OpAccessChain  %177  %154 %176
%179 = OpLoad  %27  %178
%180 = OpLoad  %4  %137
%181 = OpCompositeExtract  %13  %179 0
%182 = OpCompositeExtract  %14  %141 2
%183 = OpMatrixTimesVector  %14  %181 %182
%184 = OpFunctionCall  %6  %56 %180 %183
%185 = OpCompositeExtract  %14  %179 1
%186 = OpVectorShuffle  %18  %185 %185 0 1 2
%187 = OpCompositeExtract  %14  %141 2
%188 = OpVectorShuffle  %18  %187 %187 0 1 2
%189 = OpFSub  %18  %186 %188
%190 = OpExtInst  %18  %1 Normalize %189
%191 = OpDot  %6  %159 %190
%192 = OpExtInst  %6  %1 FMax %5 %191
%193 = OpFMul  %6  %184 %192
%194 = OpCompositeExtract  %14  %179 2
%195 = OpVectorShuffle  %18  %194 %194 0 1 2
%196 = OpVectorTimesScalar  %18  %195 %193
%197 = OpLoad  %18  %135
%198 = OpFAdd  %18  %197 %196
OpStore %135 %198
OpBranch %175
%175 = OpLabel
OpBranch %165
%165 = OpLabel
%199 = OpLoad  %4  %137
%200 = OpIAdd  %4  %199 %12
OpStore %137 %200
OpBranch %162
%163 = OpLabel
OpBranch %161
%161 = OpLabel
%201 = OpLoad  %18  %135
%202 = OpCompositeConstruct  %14  %201 %7
%204 = OpAccessChain  %203  %153 %12
%205 = OpLoad  %14  %204
%206 = OpFMul  %14  %202 %205
OpStore %150 %206
OpReturn
OpFunctionEnd
%220 = OpFunction  %2  None %97
%211 = OpLabel
%207 = OpVariable  %118  Function %208
%209 = OpVariable  %138  Function %210
%214 = OpLoad  %14  %213
%216 = OpLoad  %18  %215
%218 = OpLoad  %14  %217
%212 = OpCompositeConstruct  %19  %214 %216 %218
%221 = OpAccessChain  %26  %37 %11
%222 = OpAccessChain  %22  %40 %11
%223 = OpAccessChain  %35  %46 %11
%224 = OpLoad  %30  %49
%225 = OpLoad  %31  %51
OpBranch %226
%226 = OpLabel
%227 = OpCompositeExtract  %18  %212 1
%228 = OpExtInst  %18  %1 Normalize %227
OpStore %207 %36
OpBranch %229
%229 = OpLabel
OpStore %209 %11
OpBranch %231
%231 = OpLabel
OpLoopMerge %232 %234 None
OpBranch %233
%233 = OpLabel
%235 = OpLoad  %4  %209
%236 = OpAccessChain  %167  %221 %12 %11
%237 = OpLoad  %4  %236
%238 = OpExtInst  %4  %1 UMin %237 %10
%239 = OpULessThan  %62  %235 %238
OpSelectionMerge %240 None
OpBranchConditional %239 %240 %241
%241 = OpLabel
OpBranch %232
%240 = OpLabel
OpBranch %242
%242 = OpLabel
%244 = OpLoad  %4  %209
%246 = OpAccessChain  %245  %223 %244
%247 = OpLoad  %27  %246
%248 = OpLoad  %4  %209
%249 = OpCompositeExtract  %13  %247 0
%250 = OpCompositeExtract  %14  %212 2
%251 = OpMatrixTimesVector  %14  %249 %250
%252 = OpFunctionCall  %6  %56 %248 %251
%253 = OpCompositeExtract  %14  %247 1
%254 = OpVectorShuffle  %18  %253 %253 0 1 2
%255 = OpCompositeExtract  %14  %212 2
%256 = OpVectorShuffle  %18  %255 %255 0 1 2
%257 = OpFSub  %18  %254 %256
%258 = OpExtInst  %18  %1 Normalize %257
%259 = OpDot  %6  %228 %258
%260 = OpExtInst  %6  %1 FMax %5 %259
%261 = OpFMul  %6  %252 %260
%262 = OpCompositeExtract  %14  %247 2
%263 = OpVectorShuffle  %18  %262 %262 0 1 2
%264 = OpVectorTimesScalar  %18  %263 %261
%265 = OpLoad  %18  %207
%266 = OpFAdd  %18  %265 %264
OpStore %207 %266
OpBranch %243
%243 = OpLabel
OpBranch %234
%234 = OpLabel
%267 = OpLoad  %4  %209
%268 = OpIAdd  %4  %267 %12
OpStore %209 %268
OpBranch %231
%232 = OpLabel
OpBranch %230
%230 = OpLabel
%269 = OpLoad  %18  %207
%270 = OpCompositeConstruct  %14  %269 %7
%271 = OpAccessChain  %203  %222 %12
%272 = OpLoad  %14  %271
%273 = OpFMul  %14  %270 %272
OpStore %219 %273
OpReturn
OpFunctionEnd